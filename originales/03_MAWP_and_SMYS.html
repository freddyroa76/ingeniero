<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steel Pipe Hoop Stress Check - ASME B31.8</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        
        .main-content {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .left-panel, .right-panel {
            flex: 1;
            min-width: 300px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
        }
        
        .section {
            margin-bottom: 20px;
        }
        
        .section h3 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        
        .field-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #34495e;
        }
        
        select, input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        input[readonly] {
            background-color: #e9ecef;
            color: #495057;
        }
        
        .result-field {
            background-color: #e8f5e8;
            border: 2px solid #28a745;
        }
        
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .error {
            background-color: #f8d7da;
            border: 1px solid #f1aeb5;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .units {
            font-size: 12px;
            color: #666;
            margin-left: 5px;
        }
        
        .calculate-btn {
            background-color: #28a745;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
            width: 100%;
        }
        
        .calculate-btn:hover {
            background-color: #218838;
        }
        
        .info-text {
            font-size: 12px;
            color: #6c757d;
            font-style: italic;
            margin-top: 5px;
        }

        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 12px;
            color: #6c757d;
            border-top: 1px solid #ddd;
            padding-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Steel Pipe Hoop Stress Check - ASME B31.8</h1>
            <p style="margin: 0; color: #666; font-size: 14px;">Natural Gas Pipeline Design Calculator - Imperial Units</p>
        </div>
        
        <div class="main-content">
            <div class="left-panel">
                <div class="section">
                    <h3>Steel Pipe Dimensions</h3>
                    
                    <div class="field-group">
                        <label for="pipeSize">Pipe Nominal Size</label>
                        <select id="pipeSize" onchange="updatePipeDimensions()">
                            <option value="">Select Pipe Size</option>
                            <option value="0.125">NPS 1/8 (DN 6)</option>
                            <option value="0.25">NPS 1/4 (DN 8)</option>
                            <option value="0.375">NPS 3/8 (DN 10)</option>
                            <option value="0.5">NPS 1/2 (DN 15)</option>
                            <option value="0.75">NPS 3/4 (DN 20)</option>
                            <option value="1">NPS 1 (DN 25)</option>
                            <option value="1.25">NPS 1 1/4 (DN 32)</option>
                            <option value="1.5">NPS 1 1/2 (DN 40)</option>
                            <option value="2">NPS 2 (DN 50)</option>
                            <option value="2.5">NPS 2 1/2 (DN 65)</option>
                            <option value="3">NPS 3 (DN 80)</option>
                            <option value="3.5">NPS 3 1/2 (DN 90)</option>
                            <option value="4">NPS 4 (DN 100)</option>
                            <option value="5">NPS 5 (DN 125)</option>
                            <option value="6">NPS 6 (DN 150)</option>
                            <option value="8">NPS 8 (DN 200)</option>
                            <option value="10">NPS 10 (DN 250)</option>
                            <option value="12">NPS 12 (DN 300)</option>
                            <option value="14">NPS 14 (DN 350)</option>
                            <option value="16">NPS 16 (DN 400)</option>
                            <option value="18">NPS 18 (DN 450)</option>
                            <option value="20">NPS 20 (DN 500)</option>
                            <option value="22">NPS 22 (DN 550)</option>
                            <option value="24">NPS 24 (DN 600)</option>
                            <option value="30">NPS 30 (DN 750)</option>
                            <option value="32">NPS 32 (DN 800)</option>
                            <option value="34">NPS 34 (DN 850)</option>
                            <option value="36">NPS 36 (DN 900)</option>
                            <option value="42">NPS 42 (DN 1050)</option>
                        </select>
                        <div class="info-text">Select nominal pipe size from 1/8" to 42"</div>
                    </div>
                    
                    <div class="field-group">
                        <label for="schedule">Schedule</label>
                        <select id="schedule" onchange="updateWallThickness()" disabled>
                            <option value="">Select Schedule</option>
                        </select>
                        <div class="info-text">Available schedules for selected pipe size</div>
                    </div>
                    
                    <div class="field-group">
                        <label for="outsideDiameter">Pipe Outside Diameter, OD <span class="units">inch</span></label>
                        <input type="number" id="outsideDiameter" readonly step="0.001">
                    </div>
                    
                    <div class="field-group">
                        <label for="wallThickness">Pipe Wall Thickness, t <span class="units">inch</span></label>
                        <input type="number" id="wallThickness" readonly step="0.001">
                    </div>
                    
                    <div class="field-group">
                        <label for="insideDiameter">Pipe Inside Diameter, ID <span class="units">inch</span></label>
                        <input type="number" id="insideDiameter" readonly step="0.001">
                    </div>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="section">
                    <h3>Steel Pipe Hoop Stress Check - ASME B31.8</h3>
                    
                    <div class="field-group">
                        <label for="internalPressure">Internal Pressure <span class="units">psi</span></label>
                        <input type="number" id="internalPressure" step="0.1" oninput="calculateHoopStress()" placeholder="Enter pressure">
                    </div>
                    
                    <div class="field-group">
                        <label for="pipeGrade">Pipe Grade</label>
                        <select id="pipeGrade" onchange="updateSMYS()">
                            <option value="">Select Grade</option>
                            <option value="A">API Grade A</option>
                            <option value="B">API Grade B</option>
                            <option value="X42">API Grade X42</option>
                            <option value="X52">API Grade X52</option>
                            <option value="X60">API Grade X60</option>
                            <option value="X65">API Grade X65</option>
                            <option value="X70">API Grade X70</option>
                        </select>
                    </div>
                    
                    <div class="field-group">
                        <label for="pipeSMYS">Pipe SMYS <span class="units">psi</span></label>
                        <input type="number" id="pipeSMYS" readonly>
                    </div>
                    
                    <div class="field-group">
                        <label for="jointFactor">Longitudinal Joint Factor</label>
                        <select id="jointFactor" onchange="calculateHoopStress()">
                            <option value="1.0">1.0 (Seamless, EFW, SAW)</option>
                            <option value="0.8">0.8 (Furnace Butt Welded)</option>
                            <option value="0.6">0.6 (Other)</option>
                        </select>
                        <div class="info-text">Per ASME B31.8 Table 841.115A</div>
                    </div>
                    
                    <div class="field-group">
                        <label for="tempFactor">Temperature Derating Factor</label>
                        <select id="tempFactor" onchange="calculateHoopStress()">
                            <option value="1.0">1.0 (≤250°F)</option>
                            <option value="0.967">0.967 (300°F)</option>
                            <option value="0.933">0.933 (350°F)</option>
                            <option value="0.900">0.900 (400°F)</option>
                            <option value="0.867">0.867 (450°F)</option>
                        </select>
                        <div class="info-text">Per ASME B31.8 Table 841.116A</div>
                    </div>
                    
                    <div class="field-group">
                        <label for="locationClass">Location Class</label>
                        <select id="locationClass" onchange="updateDesignFactor()">
                            <option value="">Select Location Class</option>
                            <option value="1-div1">Class 1 Division 1</option>
                            <option value="1-div2">Class 1 Division 2</option>
                            <option value="2">Class 2</option>
                            <option value="3">Class 3</option>
                            <option value="4">Class 4</option>
                        </select>
                        <div class="info-text">Per ASME B31.8 Section 840</div>
                    </div>
                    
                    <div class="field-group">
                        <label for="designFactor">Basic Design Factor</label>
                        <input type="number" id="designFactor" readonly step="0.01">
                    </div>
                    
                    <div class="field-group">
                        <label for="hoopStress">Hoop Stress due to Internal Pressure <span class="units">psi</span></label>
                        <input type="number" id="hoopStress" readonly class="result-field">
                    </div>
                    
                    <div class="field-group">
                        <label for="percentSMYS">% SMYS</label>
                        <input type="number" id="percentSMYS" readonly class="result-field" step="0.1">
                    </div>
                    
                    <div class="field-group">
                        <label for="maxAllowable">Maximum Allowable Value <span class="units">%</span></label>
                        <input type="number" id="maxAllowable" readonly class="result-field" step="0.1">
                    </div>
                    
                    <button class="calculate-btn" onclick="calculateHoopStress()">Calculate Hoop Stress</button>
                    
                    <div id="results"></div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p><strong>ASME B31.8 Gas Transmission and Distribution Piping Systems</strong></p>
            <p>Calculator developed according to ASME B31.8 standards for natural gas pipeline design</p>
            <p>Hoop Stress Formula: S = P × D / (2 × t) | Maximum Allowable: S_max = SMYS × F × E × T</p>
        </div>
    </div>

    <script>
        // Updated pipe dimensions database with all schedules including XS
        const pipeDimensions = {
            "0.125": {
                OD: 0.405,
                schedules: {
                    "STD": 0.068,
                    "40": 0.068,
                    "XS": 0.095,
                    "80": 0.095
                }
            },
            "0.25": {
                OD: 0.540,
                schedules: {
                    "STD": 0.088,
                    "40": 0.088,
                    "XS": 0.119,
                    "80": 0.119
                }
            },
            "0.375": {
                OD: 0.675,
                schedules: {
                    "STD": 0.091,
                    "40": 0.091,
                    "XS": 0.126,
                    "80": 0.126
                }
            },
            "0.5": {
                OD: 0.840,
                schedules: {
                    "STD": 0.109,
                    "40": 0.109,
                    "XS": 0.147,
                    "80": 0.147,
                    "160": 0.187,
                    "XXS": 0.294
                }
            },
            "0.75": {
                OD: 1.050,
                schedules: {
                    "STD": 0.113,
                    "40": 0.113,
                    "XS": 0.154,
                    "80": 0.154,
                    "160": 0.219,
                    "XXS": 0.308
                }
            },
            "1": {
                OD: 1.315,
                schedules: {
                    "STD": 0.133,
                    "40": 0.133,
                    "XS": 0.179,
                    "80": 0.179,
                    "160": 0.250,
                    "XXS": 0.358
                }
            },
            "1.25": {
                OD: 1.660,
                schedules: {
                    "STD": 0.140,
                    "40": 0.140,
                    "XS": 0.191,
                    "80": 0.191,
                    "160": 0.250,
                    "XXS": 0.382
                }
            },
            "1.5": {
                OD: 1.900,
                schedules: {
                    "STD": 0.145,
                    "40": 0.145,
                    "XS": 0.200,
                    "80": 0.200,
                    "160": 0.281,
                    "XXS": 0.400
                }
            },
            "2": {
                OD: 2.375,
                schedules: {
                    "STD": 0.154,
                    "40": 0.154,
                    "XS": 0.218,
                    "80": 0.218,
                    "160": 0.344,
                    "XXS": 0.436
                }
            },
            "2.5": {
                OD: 2.875,
                schedules: {
                    "STD": 0.203,
                    "40": 0.203,
                    "XS": 0.276,
                    "80": 0.276,
                    "160": 0.375,
                    "XXS": 0.552
                }
            },
            "3": {
                OD: 3.500,
                schedules: {
                    "STD": 0.216,
                    "40": 0.216,
                    "XS": 0.300,
                    "80": 0.300,
                    "160": 0.438,
                    "XXS": 0.600
                }
            },
            "3.5": {
                OD: 4.000,
                schedules: {
                    "STD": 0.226,
                    "40": 0.226,
                    "XS": 0.318,
                    "80": 0.318
                }
            },
            "4": {
                OD: 4.500,
                schedules: {
                    "STD": 0.237,
                    "40": 0.237,
                    "XS": 0.337,
                    "80": 0.337,
                    "120": 0.438,
                    "160": 0.531,
                    "XXS": 0.674
                }
            },
            "5": {
                OD: 5.563,
                schedules: {
                    "STD": 0.258,
                    "40": 0.258,
                    "XS": 0.375,
                    "80": 0.375,
                    "120": 0.500,
                    "160": 0.625,
                    "XXS": 0.750
                }
            },
            "6": {
                OD: 6.625,
                schedules: {
                    "STD": 0.280,
                    "40": 0.280,
                    "XS": 0.432,
                    "80": 0.432,
                    "120": 0.562,
                    "160": 0.719,
                    "XXS": 0.864
                }
            },
            "8": {
                OD: 8.625,
                schedules: {
                    "10": 0.250,
                    "20": 0.277,
                    "STD": 0.322,
                    "40": 0.322,
                    "60": 0.406,
                    "XS": 0.500,
                    "80": 0.500,
                    "100": 0.594,
                    "120": 0.719,
                    "140": 0.812,
                    "160": 0.906,
                    "XXS": 0.875
                }
            },
            "10": {
                OD: 10.750,
                schedules: {
                    "10": 0.250,
                    "20": 0.250,
                    "30": 0.307,
                    "STD": 0.365,
                    "40": 0.365,
                    "60": 0.500,
                    "XS": 0.500,
                    "80": 0.594,
                    "100": 0.719,
                    "120": 0.844,
                    "140": 1.000,
                    "160": 1.125,
                    "XXS": 1.000
                }
            },
            "12": {
                OD: 12.750,
                schedules: {
                    "10": 0.250,
                    "20": 0.250,
                    "30": 0.330,
                    "STD": 0.375,
                    "40": 0.406,
                    "60": 0.562,
                    "XS": 0.500,
                    "80": 0.688,
                    "100": 0.844,
                    "120": 1.000,
                    "140": 1.125,
                    "160": 1.312,
                    "XXS": 1.000
                }
            },
            "14": {
                OD: 14.000,
                schedules: {
                    "10": 0.250,
                    "20": 0.312,
                    "30": 0.375,
                    "STD": 0.375,
                    "40": 0.438,
                    "60": 0.594,
                    "XS": 0.500,
                    "80": 0.750,
                    "100": 0.938,
                    "120": 1.094,
                    "140": 1.250,
                    "160": 1.406
                }
            },
            "16": {
                OD: 16.000,
                schedules: {
                    "10": 0.250,
                    "20": 0.312,
                    "30": 0.375,
                    "STD": 0.375,
                    "40": 0.500,
                    "60": 0.656,
                    "XS": 0.500,
                    "80": 0.844,
                    "100": 1.031,
                    "120": 1.219,
                    "140": 1.438,
                    "160": 1.594
                }
            },
            "18": {
                OD: 18.000,
                schedules: {
                    "10": 0.250,
                    "20": 0.312,
                    "30": 0.438,
                    "STD": 0.375,
                    "40": 0.562,
                    "60": 0.750,
                    "XS": 0.500,
                    "80": 0.938,
                    "100": 1.156,
                    "120": 1.375,
                    "140": 1.562,
                    "160": 1.781
                }
            },
            "20": {
                OD: 20.000,
                schedules: {
                    "10": 0.250,
                    "20": 0.375,
                    "30": 0.500,
                    "STD": 0.375,
                    "40": 0.594,
                    "60": 0.812,
                    "XS": 0.500,
                    "80": 1.031,
                    "100": 1.281,
                    "120": 1.500,
                    "140": 1.750,
                    "160": 1.969
                }
            },
            "22": {
                OD: 22.000,
                schedules: {
                    "10": 0.250,
                    "20": 0.375,
                    "30": 0.500,
                    "STD": 0.375,
                    "40": null,
                    "60": 0.875,
                    "XS": 0.500,
                    "80": 1.125,
                    "100": 1.375,
                    "120": 1.625,
                    "140": 1.875,
                    "160": 2.125
                }
            },
            "24": {
                OD: 24.000,
                schedules: {
                    "10": 0.250,
                    "20": 0.375,
                    "30": 0.562,
                    "STD": 0.375,
                    "40": 0.688,
                    "60": 0.969,
                    "XS": 0.500,
                    "80": 1.219,
                    "100": 1.531,
                    "120": 1.812,
                    "140": 2.062,
                    "160": 2.344
                }
            },
            "30": {
                OD: 30.000,
                schedules: {
                    "10": 0.312,
                    "20": 0.500,
                    "30": 0.625,
                    "STD": 0.375,
                    "40": null,
                    "60": null,
                    "XS": 0.500,
                    "80": null
                }
            },
            "32": {
                OD: 32.000,
                schedules: {
                    "10": 0.312,
                    "20": 0.500,
                    "30": 0.625,
                    "STD": 0.375,
                    "40": 0.688,
                    "60": null,
                    "XS": null,
                    "80": null
                }
            },
            "34": {
                OD: 34.000,
                schedules: {
                    "10": 0.312,
                    "20": 0.500,
                    "30": 0.625,
                    "STD": 0.375,
                    "40": 0.688,
                    "60": null,
                    "XS": null,
                    "80": null
                }
            },
            "36": {
                OD: 36.000,
                schedules: {
                    "10": 0.312,
                    "20": 0.500,
                    "30": 0.625,
                    "STD": 0.375,
                    "40": 0.750,
                    "60": null,
                    "XS": null,
                    "80": null
                }
            },
            "42": {
                OD: 42.000,
                schedules: {
                    "10": null,
                    "20": 0.500,
                    "30": 0.625,
                    "STD": 0.375,
                    "40": 0.750,
                    "60": null,
                    "XS": null,
                    "80": null
                }
            }
        };

        // Material properties (SMYS values in psi)
        const materialGrades = {
            "A": 30000,
            "B": 35000,
            "X42": 42000,
            "X52": 52000,
            "X60": 60000,
            "X65": 65000,
            "X70": 70000
        };

        // Design factors by location class (ASME B31.8)
        const designFactors = {
            "1-div1": 0.72,
            "1-div2": 0.60,
            "2": 0.50,
            "3": 0.40,
            "4": 0.40
        };

        // Function to update pipe dimensions when nominal size changes
        function updatePipeDimensions() {
            console.log('updatePipeDimensions called');
            
            const pipeSize = document.getElementById('pipeSize').value;
            const scheduleSelect = document.getElementById('schedule');
            const odField = document.getElementById('outsideDiameter');
            
            // Reset schedule dropdown
            scheduleSelect.innerHTML = '<option value="">Select Schedule</option>';
            
            if (pipeSize && pipeDimensions[pipeSize]) {
                const pipe = pipeDimensions[pipeSize];
                odField.value = pipe.OD.toFixed(3);
                
                // Populate schedule options in logical order
                const scheduleOrder = ["5", "10", "20", "30", "STD", "40", "60", "XS", "80", "100", "120", "140", "160", "XXS"];
                
                scheduleOrder.forEach(schedule => {
                    if (pipe.schedules[schedule] !== undefined && pipe.schedules[schedule] !== null) {
                        const option = document.createElement('option');
                        option.value = schedule;
                        option.textContent = schedule;
                        scheduleSelect.appendChild(option);
                    }
                });
                
                // Enable the schedule dropdown
                scheduleSelect.disabled = false;
                console.log('Schedule dropdown enabled with', Object.keys(pipe.schedules).length, 'options');
            } else {
                odField.value = '';
                scheduleSelect.disabled = true;
                console.log('Schedule dropdown disabled');
            }
            
            // Reset downstream fields
            document.getElementById('wallThickness').value = '';
            document.getElementById('insideDiameter').value = '';
            calculateHoopStress();
        }

        // Function to update wall thickness when schedule changes
        function updateWallThickness() {
            console.log('updateWallThickness called');
            
            const pipeSize = document.getElementById('pipeSize').value;
            const schedule = document.getElementById('schedule').value;
            const wallField = document.getElementById('wallThickness');
            const idField = document.getElementById('insideDiameter');
            const odField = document.getElementById('outsideDiameter');
            
            if (pipeSize && schedule && pipeDimensions[pipeSize]) {
                const pipe = pipeDimensions[pipeSize];
                const wallThickness = pipe.schedules[schedule];
                
                if (wallThickness) {
                    wallField.value = wallThickness.toFixed(3);
                    
                    // Calculate inside diameter: ID = OD - 2t
                    const od = parseFloat(odField.value);
                    const id = od - (2 * wallThickness);
                    idField.value = id.toFixed(3);
                    
                    console.log('Wall thickness updated:', wallThickness, 'ID calculated:', id);
                }
            } else {
                wallField.value = '';
                idField.value = '';
            }
            
            calculateHoopStress();
        }

        // Function to update SMYS when pipe grade changes
        function updateSMYS() {
            const grade = document.getElementById('pipeGrade').value;
            const smysField = document.getElementById('pipeSMYS');
            
            if (grade && materialGrades[grade]) {
                smysField.value = materialGrades[grade];
            } else {
                smysField.value = '';
            }
            
            calculateHoopStress();
        }

        // Function to update design factor when location class changes
        function updateDesignFactor() {
            const locationClass = document.getElementById('locationClass').value;
            const designFactorField = document.getElementById('designFactor');
            
            if (locationClass && designFactors[locationClass]) {
                designFactorField.value = designFactors[locationClass];
            } else {
                designFactorField.value = '';
            }
            
            calculateHoopStress();
        }

        // Main calculation function
        function calculateHoopStress() {
            console.log('calculateHoopStress called');
            
            // Clear previous results
            document.getElementById('results').innerHTML = '';
            
            // Get input values
            const P = parseFloat(document.getElementById('internalPressure').value) || 0;
            const D = parseFloat(document.getElementById('outsideDiameter').value) || 0;
            const t = parseFloat(document.getElementById('wallThickness').value) || 0;
            const E = parseFloat(document.getElementById('jointFactor').value) || 1.0;
            const T = parseFloat(document.getElementById('tempFactor').value) || 1.0;
            const F = parseFloat(document.getElementById('designFactor').value) || 0;
            const SMYS = parseFloat(document.getElementById('pipeSMYS').value) || 0;
            
            // Validate inputs
            if (P <= 0 || D <= 0 || t <= 0 || SMYS <= 0) {
                document.getElementById('hoopStress').value = '';
                document.getElementById('percentSMYS').value = '';
                document.getElementById('maxAllowable').value = '';
                return;
            }
            
            // Calculate hoop stress using ASME B31.8 formula: S = P * D / (2 * t)
            const hoopStress = (P * D) / (2 * t);
            
            // Calculate percentage of SMYS
            const percentSMYS = (hoopStress / SMYS) * 100;
            
            // Calculate maximum allowable stress: S_design = SMYS * F * E * T
            const maxAllowableStress = SMYS * F * E * T;
            const maxAllowablePercent = F > 0 ? (maxAllowableStress / SMYS) * 100 : 0;
            
            // Update result fields
            document.getElementById('hoopStress').value = hoopStress.toFixed(0);
            document.getElementById('percentSMYS').value = percentSMYS.toFixed(1);
            document.getElementById('maxAllowable').value = maxAllowablePercent.toFixed(1);
            
            // Display results and validation
            let resultsHTML = '<div style="margin-top: 20px;">';
            
            if (F > 0) {
                if (percentSMYS <= maxAllowablePercent) {
                    resultsHTML += '<div style="background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 10px; border-radius: 4px;">';
                    resultsHTML += '<strong>✓ DESIGN ACCEPTABLE</strong><br>';
                    resultsHTML += `Hoop stress (${percentSMYS.toFixed(1)}% SMYS) is within allowable limit (${maxAllowablePercent.toFixed(1)}% SMYS)`;
                    resultsHTML += '</div>';
                } else {
                    resultsHTML += '<div style="background-color: #f8d7da; border: 1px solid #f1aeb5; color: #721c24; padding: 10px; border-radius: 4px;">';
                    resultsHTML += '<strong>✗ DESIGN NOT ACCEPTABLE</strong><br>';
                    resultsHTML += `Hoop stress (${percentSMYS.toFixed(1)}% SMYS) exceeds allowable limit (${maxAllowablePercent.toFixed(1)}% SMYS)`;
                    resultsHTML += '</div>';
                }
            }
            
            // Add calculation details
            resultsHTML += '<div style="margin-top: 15px; font-size: 14px; background-color: #f8f9fa; padding: 10px; border-radius: 4px;">';
            resultsHTML += '<strong>Calculation Details (ASME B31.8):</strong><br>';
            resultsHTML += `<strong>Hoop Stress Formula:</strong> S = P × D / (2 × t)<br>`;
            resultsHTML += `S = ${P} × ${D.toFixed(3)} / (2 × ${t.toFixed(3)}) = <strong>${hoopStress.toFixed(0)} psi</strong><br><br>`;
            
            if (F > 0) {
                resultsHTML += `<strong>Maximum Allowable Stress:</strong> S<sub>max</sub> = SMYS × F × E × T<br>`;
                resultsHTML += `S<sub>max</sub> = ${SMYS} × ${F} × ${E} × ${T} = <strong>${maxAllowableStress.toFixed(0)} psi</strong><br>`;
                resultsHTML += `(<strong>${maxAllowablePercent.toFixed(1)}% of SMYS</strong>)<br><br>`;
                resultsHTML += `<strong>Safety Factor:</strong> ${(maxAllowableStress/hoopStress).toFixed(2)}`;
            }
            resultsHTML += '</div>';
            resultsHTML += '</div>';
            
            document.getElementById('results').innerHTML = resultsHTML;
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded - Initializing...');
            
            // Set default values
            document.getElementById('jointFactor').value = '1.0';
            document.getElementById('tempFactor').value = '1.0';
            
            // Ensure schedule dropdown starts disabled
            document.getElementById('schedule').disabled = true;
            
            console.log('Initialization complete');
        });
    </script>
</body>
</html>