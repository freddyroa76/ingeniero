<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Volumen de Gas Natural - Standing-Katz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .title {
            text-align: center;
            color: navy;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 30px;
        }
        
        .main-content {
            display: flex;
            gap: 30px;
        }
        
        .left-column {
            flex: 2;
        }
        
        .right-column {
            flex: 1;
            min-width: 300px;
        }
        
        .section {
            border: 2px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            background: #f0f0f0;
            padding: 5px 10px;
            border-radius: 4px;
        }
        
        .composition-grid {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 8px;
            align-items: center;
        }
        
        .composition-label {
            text-align: left;
        }
        
        .composition-input {
            width: 120px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        .process-section {
            margin-bottom: 15px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        
        .process-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #555;
        }
        
        .input-group {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .input-label {
            width: 120px;
            font-size: 14px;
        }
        
        .process-input {
            width: 100px;
            padding: 5px;
            margin-right: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        .input-unit {
            font-size: 12px;
            color: #666;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .calc-button {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
        }
        
        .calc-button.calculate {
            background-color: #28a745;
        }
        
        .calc-button.calculate:hover {
            background-color: #218838;
        }
        
        .calc-button.clear {
            background-color: #dc3545;
        }
        
        .calc-button.clear:hover {
            background-color: #c82333;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            background-color: #f0f0f0;
            color: #666;
            font-style: italic;
            font-size: 12px;
            border-radius: 5px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 700px;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 15px;
            top: 10px;
        }
        
        .close:hover {
            color: black;
        }
        
        .result-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .result-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
        }
        
        .main-result {
            font-size: 18px;
            font-weight: bold;
            color: #28a745;
            text-align: center;
            padding: 15px;
            background: #f8fff8;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .result-item {
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .equation-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">Calculadora de Volumen de Gas Natural - Standing-Katz</h1>
        
        <div class="main-content">
            <!-- Columna Izquierda - Composición -->
            <div class="left-column">
                <div class="section">
                    <div class="section-title">Composición del Gas Natural (fracción molar)</div>
                    <div class="composition-grid" id="composition-grid">
                        <!-- Se llena dinámicamente con JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Columna Derecha - Condiciones y Controles -->
            <div class="right-column">
                <div class="section">
                    <div class="section-title">Condiciones del Proceso</div>
                    
                    <!-- Depósito -->
                    <div class="process-section">
                        <div class="process-title">Depósito (Aguas abajo del compresor)</div>
                        <div class="input-group">
                            <span class="input-label">Volumen (V₂):</span>
                            <input type="number" class="process-input" id="v2" step="any">
                            <span class="input-unit">pies³</span>
                        </div>
                        <div class="input-group">
                            <span class="input-label">Presión (P₂):</span>
                            <input type="number" class="process-input" id="p2" step="any">
                            <span class="input-unit">psig</span>
                        </div>
                        <div class="input-group">
                            <span class="input-label">Temperatura (T₂):</span>
                            <input type="number" class="process-input" id="t2" step="any">
                            <span class="input-unit">°F</span>
                        </div>
                    </div>
                    
                    <!-- Succión -->
                    <div class="process-section">
                        <div class="process-title">Succión (Aguas arriba del compresor)</div>
                        <div class="input-group">
                            <span class="input-label">Presión (P₁):</span>
                            <input type="number" class="process-input" id="p1" step="any">
                            <span class="input-unit">psig</span>
                        </div>
                        <div class="input-group">
                            <span class="input-label">Temperatura (T₁):</span>
                            <input type="number" class="process-input" id="t1" step="any">
                            <span class="input-unit">°F</span>
                        </div>
                    </div>
                </div>
                
                <!-- Botones -->
                <div class="button-group">
                    <button class="calc-button calculate" onclick="calculate()">Calcular</button>
                    <button class="calc-button clear" onclick="clearFields()">Borrar</button>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            © Copyright Freddy Roa Monsalvo 2025 - Todos los derechos reservados
        </div>
    </div>

    <!-- Modal para Resultados -->
    <div id="resultsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 style="color: navy; text-align: center;">RESULTADOS DEL CÁLCULO</h2>
            <div id="results-content">
                <!-- Se llena dinámicamente -->
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="calc-button clear" onclick="closeModal()" style="width: 150px;">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        // Propiedades críticas de los componentes (Pc en psia, Tc en °R)
        const criticalProps = {
            'CH₄': {Pc: 667.8, Tc: 343.0},
            'N₂': {Pc: 493.1, Tc: 227.16},
            'CO₂': {Pc: 1071.0, Tc: 547.58},
            'C₂H₆': {Pc: 707.8, Tc: 549.59},
            'C₃H₈': {Pc: 616.3, Tc: 665.73},
            'H₂O': {Pc: 3206.2, Tc: 1165.14},
            'H₂S': {Pc: 1306.0, Tc: 672.35},
            'H₂': {Pc: 188.0, Tc: 59.67},
            'CO': {Pc: 507.5, Tc: 239.2},
            'O₂': {Pc: 731.4, Tc: 278.6},
            'n-C₄H₁₀': {Pc: 550.7, Tc: 765.29},
            'i-C₄H₁₀': {Pc: 529.1, Tc: 734.13},
            'n-C₅H₁₂': {Pc: 488.6, Tc: 845.47},
            'i-C₅H₁₂': {Pc: 490.4, Tc: 828.77},
            'n-C₆H₁₄': {Pc: 436.9, Tc: 913.4},
            'n-C₇H₁₆': {Pc: 396.8, Tc: 972.4},
            'n-C₈H₁₈': {Pc: 360.7, Tc: 1023.9},
            'n-C₉H₂₀': {Pc: 332.0, Tc: 1070.4},
            'C₁₀H₂₂': {Pc: 304.0, Tc: 1111.8},
            'He': {Pc: 33.2, Tc: 9.5},
            'Ar': {Pc: 705.0, Tc: 271.4}
        };
        
        // Nombres de componentes en orden
        const componentNames = [
            'CH₄', 'N₂', 'CO₂', 'C₂H₆', 'C₃H₈', 'H₂O', 'H₂S', 'H₂', 'CO', 'O₂',
            'n-C₄H₁₀', 'i-C₄H₁₀', 'n-C₅H₁₂', 'i-C₅H₁₂', 'n-C₆H₁₄', 'n-C₇H₁₆', 
            'n-C₈H₁₈', 'n-C₉H₂₀', 'C₁₀H₂₂', 'He', 'Ar'
        ];
        
        // Nombres descriptivos
        const displayNames = {
            'CH₄': 'CH4 (Metano)',
            'N₂': 'N2 (Nitrógeno)',
            'CO₂': 'CO2 (Dióxido de carbono)',
            'C₂H₆': 'C2H6 (Etano)',
            'C₃H₈': 'C3H8 (Propano)',
            'H₂O': 'H2O (Vapor de agua)',
            'H₂S': 'H2S (Sulfuro de hidrógeno)',
            'H₂': 'H2 (Hidrógeno)',
            'CO': 'CO (Monóxido de carbono)',
            'O₂': 'O2 (Oxígeno)',
            'n-C₄H₁₀': 'n-C4H10 (n-Butano)',
            'i-C₄H₁₀': 'i-C4H10 (Isobutano)',
            'n-C₅H₁₂': 'n-C5H12 (n-Pentano)',
            'i-C₅H₁₂': 'i-C5H12 (Isopentano)',
            'n-C₆H₁₄': 'n-C6H14 (Hexano)',
            'n-C₇H₁₆': 'n-C7H16 (Heptano)',
            'n-C₈H₁₈': 'n-C8H18 (Octano)',
            'n-C₉H₂₀': 'n-C9H20 (Nonano)',
            'C₁₀H₂₂': 'C10H22 (Decano)',
            'He': 'He (Helio)',
            'Ar': 'Ar (Argón)'
        };
        
        // Inicializar la interfaz
        function initializeInterface() {
            const grid = document.getElementById('composition-grid');
            
            componentNames.forEach(component => {
                // Label
                const label = document.createElement('div');
                label.className = 'composition-label';
                label.textContent = displayNames[component] + ':';
                grid.appendChild(label);
                
                // Input
                const input = document.createElement('input');
                input.type = 'number';
                input.className = 'composition-input';
                input.id = component;
                input.step = 'any';
                input.min = '0';
                input.max = '1';
                grid.appendChild(input);
            });
        }
        
        // Validar composición
        function validateComposition() {
            let total = 0;
            const composition = {};
            
            for (const component of componentNames) {
                const input = document.getElementById(component);
                const value = parseFloat(input.value) || 0;
                
                if (value < 0 || value > 1) {
                    alert(`El valor para ${displayNames[component]} debe estar entre 0 y 1`);
                    return null;
                }
                
                composition[component] = value;
                total += value;
            }
            
            if (Math.abs(total - 1.0) > 0.001) {
                alert(`La composición suma ${total.toFixed(4)} (debe ser 1.0000)`);
                return null;
            }
            
            return composition;
        }
        
        // Calcular propiedades pseudocríticas
        function calculatePseudocriticalProps(composition) {
            let ppc = 0;
            let tpc = 0;
            
            for (const [component, fraction] of Object.entries(composition)) {
                if (fraction > 0) {
                    ppc += fraction * criticalProps[component].Pc;
                    tpc += fraction * criticalProps[component].Tc;
                }
            }
            
            return {ppc, tpc};
        }
        
        // Factor Z de Standing-Katz
        function standingKatzZFactor(pr, tr) {
            let z;
            
            if (pr <= 0.5) {
                z = 1.0 - (pr / tr) * (0.344 + 1.024 * Math.exp(-3.2 * pr));
            } else if (pr <= 2.0) {
                z = 1.0 + pr * (0.3647 - 0.8 * Math.exp(-0.6 * pr)) / tr;
            } else {
                const A = 1.39 * Math.pow(tr - 0.92, 0.5) - 0.36 * tr - 0.101;
                const B = (0.62 - 0.23 * tr) * pr + (0.066 / (tr - 0.86) - 0.037) * Math.pow(pr, 2) + 
                         0.32 * Math.pow(pr, 6) / Math.pow(10, 9 * (tr - 1));
                const C = 0.132 - 0.32 * Math.log10(tr);
                const D = Math.pow(10, 0.3106 - 0.49 * tr + 0.1824 * Math.pow(tr, 2));
                
                z = A + (1 - A) / Math.exp(B) + C * Math.pow(pr, D);
            }
            
            return Math.max(0.2, Math.min(2.0, z));
        }
        
        // Función principal de cálculo
        function calculate() {
            try {
                // Validar composición
                const composition = validateComposition();
                if (!composition) return;
                
                // Obtener datos de entrada
                const V2 = parseFloat(document.getElementById('v2').value);
                const P2_psig = parseFloat(document.getElementById('p2').value);
                const T2_f = parseFloat(document.getElementById('t2').value);
                const P1_psig = parseFloat(document.getElementById('p1').value);
                const T1_f = parseFloat(document.getElementById('t1').value);
                
                if (isNaN(V2) || isNaN(P2_psig) || isNaN(T2_f) || isNaN(P1_psig) || isNaN(T1_f)) {
                    alert('Por favor, complete todos los campos de proceso');
                    return;
                }
                
                // Conversiones de unidades
                const P1_psia = P1_psig + 14.7;
                const P2_psia = P2_psig + 14.7;
                const T1_r = T1_f + 459.67;
                const T2_r = T2_f + 459.67;
                
                // Calcular propiedades pseudocríticas
                const {ppc, tpc} = calculatePseudocriticalProps(composition);
                
                // Calcular propiedades reducidas
                const Pr1 = P1_psia / ppc;
                const Tr1 = T1_r / tpc;
                const Pr2 = P2_psia / ppc;
                const Tr2 = T2_r / tpc;
                
                // Calcular factores Z
                const Z1 = standingKatzZFactor(Pr1, Tr1);
                const Z2 = standingKatzZFactor(Pr2, Tr2);
                
                // Calcular V1
                const V1 = V2 * (P2_psia / P1_psia) * (Z1 / Z2) * (T1_r / T2_r);
                
                // Mostrar resultados
                showResults(V1, Z1, Z2, ppc, tpc, Pr1, Tr1, Pr2, Tr2, P1_psia, P2_psia, T1_r, T2_r, V2);
                
            } catch (error) {
                alert('Error en el cálculo: ' + error.message);
            }
        }
        
        // Mostrar resultados
        function showResults(V1, Z1, Z2, ppc, tpc, Pr1, Tr1, Pr2, Tr2, P1, P2, T1, T2, V2) {
            const modal = document.getElementById('resultsModal');
            const content = document.getElementById('results-content');
            
            content.innerHTML = `
                <div class="main-result">
                    Volumen de gas en condiciones de succión (V₁):<br>
                    ${V1.toLocaleString('es-ES', {maximumFractionDigits: 2})} pies³
                </div>
                
                <div class="result-section">
                    <div class="result-title">Propiedades Pseudocríticas</div>
                    <div class="result-item">Presión pseudocrítica (Ppc): ${ppc.toFixed(2)} psia</div>
                    <div class="result-item">Temperatura pseudocrítica (Tpc): ${tpc.toFixed(2)} °R</div>
                </div>
                
                <div class="result-section">
                    <div class="result-title">Propiedades Reducidas</div>
                    <div class="result-item"><strong>Condiciones de Succión (Estado 1):</strong></div>
                    <div class="result-item">&nbsp;&nbsp;Pr₁ = ${Pr1.toFixed(3)}</div>
                    <div class="result-item">&nbsp;&nbsp;Tr₁ = ${Tr1.toFixed(3)}</div>
                    <div class="result-item"><strong>Condiciones del Depósito (Estado 2):</strong></div>
                    <div class="result-item">&nbsp;&nbsp;Pr₂ = ${Pr2.toFixed(3)}</div>
                    <div class="result-item">&nbsp;&nbsp;Tr₂ = ${Tr2.toFixed(3)}</div>
                </div>
                
                <div class="result-section">
                    <div class="result-title">Factores de Compresibilidad</div>
                    <div class="result-item">Z₁ (condiciones de succión): ${Z1.toFixed(4)}</div>
                    <div class="result-item">Z₂ (condiciones del depósito): ${Z2.toFixed(4)}</div>
                </div>
                
                <div class="result-section">
                    <div class="result-title">Condiciones Convertidas</div>
                    <div class="result-item"><strong>Estado 1 (Succión):</strong></div>
                    <div class="result-item">&nbsp;&nbsp;P₁ = ${P1.toFixed(1)} psia</div>
                    <div class="result-item">&nbsp;&nbsp;T₁ = ${T1.toFixed(1)} °R</div>
                    <div class="result-item"><strong>Estado 2 (Depósito):</strong></div>
                    <div class="result-item">&nbsp;&nbsp;P₂ = ${P2.toFixed(1)} psia</div>
                    <div class="result-item">&nbsp;&nbsp;T₂ = ${T2.toFixed(1)} °R</div>
                </div>
                
                <div class="result-section">
                    <div class="result-title">Ecuación Utilizada</div>
                    <div class="equation-box">
                        V₁ = V₂ × (P₂/P₁) × (Z₁/Z₂) × (T₁/T₂)<br><br>
                        V₁ = ${V2.toLocaleString('es-ES')} × (${P2.toFixed(1)}/${P1.toFixed(1)}) × (${Z1.toFixed(4)}/${Z2.toFixed(4)}) × (${T1.toFixed(1)}/${T2.toFixed(1)})
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 15px; font-size: 12px; color: #666;">
                    © Freddy Roa Monsalvo 2025
                </div>
            `;
            
            modal.style.display = 'block';
        }
        
        // Cerrar modal
        function closeModal() {
            document.getElementById('resultsModal').style.display = 'none';
        }
        
        // Limpiar campos
        function clearFields() {
            // Limpiar composición
            componentNames.forEach(component => {
                document.getElementById(component).value = '';
            });
            
            // Limpiar condiciones de proceso
            document.getElementById('v2').value = '';
            document.getElementById('p2').value = '';
            document.getElementById('t2').value = '';
            document.getElementById('p1').value = '';
            document.getElementById('t1').value = '';
        }
        
        // Cerrar modal al hacer clic fuera de él
        window.onclick = function(event) {
            const modal = document.getElementById('resultsModal');
            if (event.target === modal) {
                closeModal();
            }
        }
        
        // Inicializar cuando se carga la página
        document.addEventListener('DOMContentLoaded', initializeInterface);
    </script>
</body>
</html>